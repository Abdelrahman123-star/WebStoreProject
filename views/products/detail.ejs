<!DOCTYPE html>
<html lang="en">
<head>
  <!-- dah btaa3 el icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- w dah btaa3 el fonts-->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="productDetailPage.title"><%= product.name %></title>
    <link rel="stylesheet" href="/css/productsAndCart.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Add Lightbox CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" rel="stylesheet">

    <!-- Add i18next and plugins from CDN -->
    <script src="https://unpkg.com/i18next/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-http-backend/i18nextHttpBackend.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector/i18nextBrowserLanguageDetector.min.js"></script>
    <script src="/js/i18n.js"></script>

    <style>
      /* Zoom container styles */
      .medium-zoom-overlay {
        background-color: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .medium-zoom-image {
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
      }

      .medium-zoom-image:hover {
        transform: scale(1.02);
      }

      /* Product image container */
      .product-images {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        cursor: pointer;
      }

      .main-image {
        width: 100%;
        height: auto;
        transition: transform 0.3s ease;
      }

      .product-images:hover .main-image {
        transform: scale(1.02);
      }

      /* Zoom hint */
      .zoom-hint {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .product-images:hover .zoom-hint {
        opacity: 1;
      }

      /* Lightbox custom styles */
      .lb-data .lb-caption {
        font-size: 16px;
        font-weight: 500;
      }

      .lb-data .lb-number {
        font-size: 14px;
      }

      .lb-closeContainer {
        position: absolute;
        top: 20px;
        right: 20px;
      }

      /* Add these styles to your existing styles */
      .stock-status {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        margin: 1rem 0;
      }

      .stock-count {
        font-size: 0.85rem;
        opacity: 0.8;
      }

      .quantity button:disabled,
      .quantity input:disabled,
      .add-to-cart:disabled,
      .buy-now:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .quantity input {
        width: 60px;
        height: 40px;
        text-align: center;
        border: 2px solid #f1f2f6;
        border-radius: 8px;
        font-size: 1.1rem;
      }

      .quantity input:invalid {
        border-color: #e74c3c;
      }

      .quantity button {
        width: 40px;
        height: 40px;
        border: none;
        background: #f1f2f6;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quantity button:not(:disabled):hover {
        background: #00b894;
        color: white;
      }
      .product-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      /* Custom Notification Styles */
      .custom-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        background: linear-gradient(45deg, #00b894, #0984e3);
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transform: translateX(120%);
        transition: transform 0.3s ease-in-out;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .custom-notification.show {
        transform: translateX(0);
      }

      .custom-notification i {
        font-size: 1.2rem;
      }

      .custom-notification .message {
        font-size: 1rem;
        font-weight: 500;
      }

      /* Simple Notification */
      #cart-message {
        position: fixed;
        top: 6em;
        right:6em;
        background: #00b894;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        text-align: center;
        display: none; /* Show with JS or as needed */

      }
    </style>
</head>
<body>
    <!-- Header -->
    <%- include('../components/header') %>
    <%- include('../components/backButton') %>
    <%- include('../components/switchLanguage') %>
    <div id="cart-message" data-i18n="productDetailPage.actions.addToCart">Item has been added to cart!</div>

    <main class="product-container">
        <div class="product-layout">
            <!-- Left Column: Product Images -->
            <div class="product-gallery">
                <div class="main-image-container">
                    <% if (product.imageUrl && product.imageUrl.trim() !== '') { %>
                        <a href="<%= product.imageUrl %>" data-lightbox="product-image" data-title="<%= product.name %>">
                            <img src="<%= product.imageUrl %>" alt="<%= product.name %>" class="main-image">
                        </a>
                    <% } else if (product.imagePath && product.imagePath.trim() !== '') { %>
                        <a href="<%= product.imagePath %>" data-lightbox="product-image" data-title="<%= product.name %>">
                            <img src="<%= product.imagePath %>" alt="<%= product.name %>" class="main-image">
                        </a>
                    <% } else { %>
                        <a href="/imgs/img-notfound.jpg" data-lightbox="product-image" data-title="Image Not Found">
                            <img src="/imgs/img-notfound.jpg" alt="Image Not Found" class="main-image">
                        </a>
                    <% } %>
                    <div class="zoom-hint" data-i18n="productDetailPage.zoom.hint">
                        <i class="fas fa-search-plus"></i> Click to zoom
                    </div>
                </div>
            </div>

            <!-- Right Column: Product Info -->
            <div class="product-info">
                <div class="product-header">
                    <h1 class="product-title"><%= product.name %></h1>
                    <div class="product-rating">
                        <div class="stars">
                            <% for(let i = 1; i <= 5; i++) { %>
                                <i class="fas fa-star <%= i <= Math.round(product.rating) ? 'active' : '' %>"></i>
                            <% } %>
                        </div>
                        <span class="rating-count">(<%= product.numberOfReviews %> <span data-i18n="productDetailPage.reviews.reviews">reviews</span>)</span>
                    </div>
                </div>

                <div class="price-section">
                    <% if (hasDiscount) { %>
                        <div class="price-wrapper">
                            <span class="original-price">EGP <s><%= originalPrice %></s></span>
                            <span class="discounted-price">EGP <%= discountedPrice %></span>
                            <span class="discount-badge"><%= discountPercentage %>% OFF</span>
                        </div>
                    <% } else { %>
                        <span class="current-price">EGP <%= product.price %></span>
                    <% } %>
                </div>
                <div class="product-description">
                  <h3 data-i18n="productDetailPage.description">Description</h3>
                  <p><%= product.description %></p>
                </div>
                <div class="stock-status <%= product.stock > 10 ? 'in-stock' : (product.stock > 0 ? 'low-stock' : 'out-of-stock') %>">
                    <i class="fas <%= product.stock > 10 ? 'fa-check-circle' : (product.stock > 0 ? 'fa-exclamation-circle' : 'fa-times-circle') %>"></i>
                    <span data-i18n="productDetailPage.stock.<%= product.stock > 10 ? 'inStock' : (product.stock > 0 ? 'lowStock' : 'outOfStock') %>">
                        <%= product.stock > 10 ? 'In Stock' : (product.stock > 0 ? 'Low Stock' : 'Out of Stock') %>
                    </span>
                    <% if (product.stock > 0) { %>
                        <span class="stock-count">(<%= product.stock %> <span data-i18n="productDetailPage.stock.available">available</span>)</span>
                    <% } %>
                </div>

                <div class="product-actions">
                    <div class="quantity-selector">
                        <span data-i18n="productDetailPage.actions.quantity">Quantity</span>
                        <button class="quantity-btn minus" onclick="updateQuantity(-1)">-</button>
                        <input type="number" id="quantity" value="1" min="1" max="<%= product.stock %>" onchange="validateQuantity(this)">
                        <button class="quantity-btn plus" onclick="updateQuantity(1)">+</button>
                    </div>

                    <div class="action-buttons">
                        <% if (session && session.user) { %>
                            <button class="btn-add-cart" id="add-to-cart-btn" data-i18n="productDetailPage.actions.addToCart">
                                <i class="fas fa-shopping-cart"></i>
                                Add to Cart
                            </button>
                        <% } else { %>
                            <button class="btn-login" onclick="window.location.href='/login'" data-i18n="productDetailPage.actions.loginToAdd">
                                <i class="fas fa-sign-in-alt"></i>
                                Login to Add to Cart
                            </button>
                        <% } %>

                        <button class="btn-buy-now" onclick="window.location.href='/myCart' "
                                <%= product.stock <= 0 ? 'disabled' : '' %>
                                data-i18n="productDetailPage.actions.buyNow">
                            <i class="fas fa-bolt"></i>
                            Buy Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <section class="comments-section">
          <h3 data-i18n="productDetailPage.reviews.title">Customer Reviews</h3>
          
          <!-- Rating Summary -->
          <div class="rating-summary">
            <div class="overall-rating">
              <div class="rating-number"><%= product.rating.toFixed(1) %></div>
              <div class="rating-stars">
                <% for(let i = 1; i <= 5; i++) { %>
                  <i class="fas fa-star <%= i <= Math.round(product.rating) ? 'active' : '' %>"></i>
                <% } %>
              </div>
              <div class="rating-count"><%= product.numberOfReviews %> <span data-i18n="productDetailPage.reviews.reviews">reviews</span></div>
            </div>
            <div class="rating-distribution">
              <% for(let i = 5; i >= 1; i--) { %>
                <div class="rating-bar">
                  <span class="rating-label"><%= i %> <span data-i18n="productDetailPage.reviews.stars">stars</span></span>
                  <div class="progress-bar">
                    <% const width = ((comments.filter(c => c.rating === i).length / (product.numberOfReviews || 1)) * 100).toFixed(0); %>
                    <div class="progress progress-<%= width %>"></div>
                  </div>
                  <span class="rating-count"><%= comments.filter(c => c.rating === i).length %></span>
                </div>
              <% } %>
            </div>
          </div>

          <!-- Comment Form -->
          <div class="comment-form-container">
              <% if (session && session.user) { %>
                  <form id="commentForm" class="comment-form">
                      <div class="rating-input">
                          <label data-i18n="productDetailPage.reviews.yourRating">Your Rating:</label>
                          <div class="star-rating">
                              <% for(let i = 5; i >= 1; i--) { %>
                                  <input type="radio" id="star<%= i %>" name="rating" value="<%= i %>" required>
                                  <label for="star<%= i %>"><i class="fas fa-star"></i></label>
                              <% } %>
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="commentContent" data-i18n="productDetailPage.reviews.yourReview">Your Review:</label>
                          <textarea id="commentContent" name="content" rows="4" required 
                                  data-i18n-placeholder="productDetailPage.reviews.reviewPlaceholder"
                                  placeholder="Share your experience with this product..."></textarea>
                      </div>
                      <button type="submit" class="submit-comment" data-i18n="productDetailPage.reviews.submitReview">
                          <i class="fas fa-paper-plane"></i> Submit Review
                      </button>
                  </form>
              <% } else { %>
                  <div class="login-prompt">
                      <p><span data-i18n="productDetailPage.reviews.loginToReview">Please login to leave a review</span> 
                         <a href="/login" data-i18n="productDetailPage.reviews.login">login</a></p>
                  </div>
              <% } %>
          </div>

          <!-- Comments List -->
          <div class="comments-list">
              <% if (comments && comments.length > 0) { %>
                  <% comments.forEach(comment => { %>
                      <div class="comment-card">
                          <div class="comment-header">
                              <div class="user-info">
                                  <i class="fas fa-user-circle"></i>
                                  <span class="username"><%= comment.user.username %></span>
                              </div>
                              <div class="rating">
                                  <% for(let i = 1; i <= 5; i++) { %>
                                      <i class="fas fa-star <%= i <= comment.rating ? 'active' : '' %>"></i>
                                  <% } %>
                              </div>
                          </div>
                          <div class="comment-content">
                              <%= comment.content %>
                          </div>
                          <div class="comment-footer">
                              <span class="comment-date"><%= new Date(comment.createdAt).toLocaleDateString() %></span>
                              <span class="comment-status <%= comment.status %>" data-i18n="productDetailPage.reviews.status.<%= comment.status %>">
                                  <%= comment.status.charAt(0).toUpperCase() + comment.status.slice(1) %>
                              </span>
                          </div>
                      </div>
                  <% }); %>
              <% } else { %>
                  <p class="no-comments" data-i18n="productDetailPage.reviews.noReviews">No reviews yet. Be the first to review this product!</p>
              <% } %>
          </div>
      </section>

        <section class="related-products-section">
            <h3 data-i18n="productDetailPage.relatedProducts.title">More Products You Might Like</h3>
            <div class="related-products-grid">
              <% if (relatedProducts && relatedProducts.length > 0) { %>
                <% relatedProducts.forEach(function(relatedProduct) { %>
                  <div class="related-product-card" onclick="window.location.href='/products/detail/<%= relatedProduct._id %>'">
                    <% if (relatedProduct.imageUrl && relatedProduct.imageUrl.trim() !== '') { %>
                      <img src="<%= relatedProduct.imageUrl %>" alt="<%= relatedProduct.name %>">
                    <% } else if (relatedProduct.imagePath && relatedProduct.imagePath.trim() !== '') { %>
                      <img src="<%= relatedProduct.imagePath %>" alt="<%= relatedProduct.name %>">
                    <% } else { %>
                      <img src="/imgs/img-notfound.jpg" alt="Image Not Found">
                    <% } %>
                    <div class="related-product-info">
                        <p class="related-product-name"><%= relatedProduct.name %></p>
                        <p class="related-product-price">EGP <%= relatedProduct.price %></p>
                    </div>
                  </div>
                <% }) %>
              <% } else { %>
                <p class="no-related-products" data-i18n="productDetailPage.relatedProducts.noProducts">No related products found.</p>
              <% } %>
            </div>
        </section>
    </main>

    <%- include('../components/footer') %>

    <script src="/js/product_cart.js"></script>
    <!-- Add Lightbox JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>
    <script>
        lightbox.option({
            'resizeDuration': 200,
            'wrapAround': true,
            'fadeDuration': 300,
            'imageFadeDuration': 300,
            'positionFromTop': 100,
            'maxWidth': 1200,
            'maxHeight': 800
        });
    </script>
    <script>
        // Add event listener for the Add to Cart button
        document.getElementById('add-to-cart-btn')?.addEventListener('click', function() {
            const quantity = parseInt(document.getElementById('quantity').value);
            const productId = '<%= product._id %>';
            const productName = '<%= product.name %>';

            const headers = {
                'Content-Type': 'application/json',
            };

            fetch('/myCart/add', {
                method: 'POST',
                headers: headers,
                credentials: 'same-origin',
                body: JSON.stringify({
                    productId,
                    quantity
                })
            })
            .then(response => {
                if (!response.ok && response.redirected) {
                    console.error('Server responded with non-OK status after redirect:', response.status);
                } else if (response.ok && !response.redirected) {
                    // Show success notification
                    showNotification(`${quantity} ${quantity === 1 ? 'item' : 'items'} of ${productName} added to your cart!`);
                    window.location.reload();
                }
            })
            .catch(error => {
                console.error('Network or fetch error:', error);
                showNotification('Failed to add item to cart. Please try again.');
            });
        });

        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'custom-notification';
            notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span class="message">${message}</span>
            `;
            
            // Add to body
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide and remove after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 4000);
        }

        function validateQuantity(input) {
            const max = parseInt(input.getAttribute('max'));
            const value = parseInt(input.value);
            
            if (value < 1) {
                input.value = 1;
            } else if (value > max) {
                input.value = max;
            }
        }

        function updateQuantity(change) {
            const input = document.getElementById('quantity');
            const newValue = parseInt(input.value) + change;
            if (newValue >= 1 && newValue <= parseInt('<%= product.stock %>')) {
                input.value = newValue;
            }
        }
    </script>

    <style>
        /* Modern Product Layout Styles */
        .product-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .product-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }

        /* Product Gallery Styles */
        .product-gallery {
            position: relative;
        }

        .main-image-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .main-image {
            width: 100%;
            height: auto;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .main-image:hover {
            transform: scale(1.05);
        }

        .zoom-hint {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .main-image-container:hover .zoom-hint {
            opacity: 1;
        }

        /* Product Info Styles */
        .product-info {
            display: flex;
            flex-direction: column;
        }

        .product-header {
            margin-bottom: 1rem;
        }

        .product-title {
            font-size: 2rem;
            color: #2d3436;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stars {
            color: #ffd700;
            display: flex;
            gap: 0.2rem;
        }

        .rating-count {
            color: #666;
            font-size: 0.9rem;
        }

        /* Price Section Styles */
        .price-section {
            margin: 1rem 0;
        }

        .price-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .original-price {
            color: #95a5a6;
            text-decoration: line-through;
            font-size: 1.1rem;
        }

        .discounted-price {
            color: #e74c3c;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .discount-badge {
            background: #e74c3c;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .current-price {
            color: #2d3436;
            font-size: 1.8rem;
            font-weight: 600;
        }

        /* Stock Status Styles */
        .stock-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.2rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .stock-status.in-stock {
            background: #d4edda;
            color: #155724;
        }

        .stock-status.low-stock {
            background: #fff3cd;
            color: #856404;
        }

        .stock-status.out-of-stock {
            background: #f8d7da;
            color: #721c24;
        }

        /* Product Description Styles */
        .product-description {
            margin: 1rem 0;
        }

        .product-description h3 {
            font-size: 1.2rem;
            color: #2d3436;
            margin-bottom: 0.8rem;
        }

        .product-description p {
            color: #636e72;
            line-height: 1.6;
        }

        /* Product Actions Styles */
        .product-actions {
            display: flex;
            flex-direction: column;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 10px;
            width: fit-content;
        }

        .quantity-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #ffffff;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover:not(:disabled) {
            background: #00b894;
            color: white;
        }

        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #quantity {
            width: 60px;
            height: 40px;
            text-align: center;
            border: 2px solid #f1f2f6;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn-add-cart, .btn-login, .btn-buy-now {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            transition: all 0.3s ease;
        }

        .btn-add-cart {
            background: linear-gradient(45deg, #0984e3, #00b894);
            color: white;
        }

        .btn-add-cart:hover {
            background: linear-gradient(45deg, #00b894, #0984e3);
            transform: translateY(-2px);
        }

        .btn-login {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
        }

        .btn-login:hover {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            transform: translateY(-2px);
        }

        .btn-buy-now {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-buy-now:hover:not(:disabled) {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            transform: translateY(-2px);
        }

        .btn-buy-now:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .product-layout {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .product-gallery {
                max-width: 600px;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .product-container {
                padding: 1rem;
            }

            .product-layout {
                padding: 1rem;
            }

            .product-title {
                font-size: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-add-cart, .btn-login, .btn-buy-now {
                width: 100%;
            }
        }
    </style>

    <script>
        // Comment form submission
        document.getElementById('commentForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const rating = document.querySelector('input[name="rating"]:checked')?.value;
            const content = document.getElementById('commentContent').value;
            
            if (!rating || !content) {
                alert('Please provide both rating and review content');
                return;
            }

            try {
                const response = await fetch('/api/comments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productId: '<%= product._id %>',
                        rating: parseInt(rating),
                        content: content
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Show success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'alert alert-success';
                    successMessage.textContent = data.message || 'Thank you for your review! It will be visible after approval.';
                    document.querySelector('.comment-form-container').prepend(successMessage);

                    // Clear form
                    document.getElementById('commentForm').reset();
                    
                    // Remove success message after 5 seconds
                    setTimeout(() => {
                        successMessage.remove();
                    }, 5000);
                } else {
                    // Show error message
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'alert alert-danger';
                    errorMessage.textContent = data.error || 'Failed to submit review';
                    document.querySelector('.comment-form-container').prepend(errorMessage);

                    // Remove error message after 5 seconds
                    setTimeout(() => {
                        errorMessage.remove();
                    }, 5000);
                }
            } catch (error) {
                console.error('Error:', error);
                // Show error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'alert alert-danger';
                errorMessage.textContent = 'An error occurred while submitting your review';
                document.querySelector('.comment-form-container').prepend(errorMessage);

                // Remove error message after 5 seconds
                setTimeout(() => {
                    errorMessage.remove();
                }, 5000);
            }
        });
    </script>

    <style>
        /* Remove flash message styles */
        .product-actions {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .product-actions .btn-primary,
        .product-actions .buy-now-btn {
            flex-grow: 1; /* Allow buttons to grow and take available space */
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            cursor: pointer;

            min-width: 180px; /* Ensure a minimum width for buttons */
            border: none; /* Ensure no default button border */
        }

        .product-actions .btn-primary { /* Add to Cart */
            background: linear-gradient(45deg, #0984e3, #00b894);
            color: white;
            box-shadow: 0 4px 15px rgba(9, 132, 227, 0.3);
        }

        .product-actions .btn-primary:hover {
            background: linear-gradient(45deg, #00b894, #0984e3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(9, 132, 227, 0.4);
        }

        .buy-now-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        .buy-now-btn:hover {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        /* Adjust quantity selector for flex layout */
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-selector input {
            width: 60px; /* Adjust width if needed */
            text-align: center;
        }

        .quantity button {
            width: 40px;
            height: 40px;
            border: none;
            background: #f1f2f6;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quantity button:not(:disabled):hover {
            background: #00b894;
            color: white;
        }

        /* Comments Section Styles */
        .comments-section {
            margin-top: 3rem;
            padding: 2rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .comments-section h3 {
            font-size: 1.5rem;
            color: #2d3436;
            margin-bottom: 1.5rem;
        }

        .comment-form-container {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .comment-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .rating-input {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .star-rating {
            display: flex;
            flex-direction: row-reverse;
            gap: 0.5rem;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            cursor: pointer;
            color: #ddd;
            font-size: 1.5rem;
            transition: color 0.2s ease;
        }

        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #ffd700;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            color: #2d3436;
        }

        .form-group textarea {
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
        }

        .submit-comment {
            align-self: flex-start;
            padding: 0.8rem 1.5rem;
            background: #00b894;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .submit-comment:hover {
            background: #00a884;
            transform: translateY(-2px);
        }

        .login-prompt {
            text-align: center;
            padding: 1rem;
            background: #fff3cd;
            border-radius: 8px;
            color: #856404;
        }

        .login-prompt a {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }

        .login-prompt a:hover {
            text-decoration: underline;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .comment-card {
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

    

        .username {
            font-weight: 500;
            color: #2d3436;
        }

        .rating {
            color: #ffd700;
            display: flex;
            gap: 0.2rem;
        }

        .rating i {
            font-size: 1rem;
        }

        .rating i.active {
            color: #ffd700;
        }

        .rating i:not(.active) {
            color: #ddd;
        }

        .comment-content {
            color: #2d3436;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .comment-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .comment-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .comment-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .comment-status.approved {
            background: #d4edda;
            color: #155724;
        }

        .comment-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .no-comments {
            text-align: center;
            color: #666;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .rating-summary {
          display: flex;
          gap: 2rem;
          margin-bottom: 2rem;
          padding: 1.5rem;
          background: #f8f9fa;
          border-radius: 8px;
        }

        .overall-rating {
          text-align: center;
          padding: 1rem;
          min-width: 200px;
        }

        .rating-number {
          font-size: 3rem;
          font-weight: 600;
          color: #2d3436;
          line-height: 1;
          margin-bottom: 0.5rem;
        }

        .rating-stars {
          color: #ffd700;
          font-size: 1.2rem;
          margin-bottom: 0.5rem;
          display: flex;
          gap: 0.2rem;
        }

        .rating-stars i {
          font-size: 1.2rem;
        }

        .rating-stars i.active {
          color: #ffd700;
        }

        .rating-stars i:not(.active) {
          color: #ddd;
        }

        .rating-count {
          color: #666;
          font-size: 0.9rem;
        }

        .rating-distribution {
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .rating-bar {
          display: flex;
          align-items: center;
          gap: 1rem;
        }

        .rating-label {
          min-width: 70px;
          color: #2d3436;
          font-size: 0.9rem;
        }

        .progress-bar {
          flex: 1;
          height: 8px;
          background: #eee;
          border-radius: 4px;
          overflow: hidden;
        }

        .progress {
          height: 100%;
          background: #ffd700;
          border-radius: 4px;
          transition: width 0.3s ease;
        }

        <% for(let i = 0; i <= 100; i++) { %>
        .progress-<%= i %> {
          width: <%= i %>%;
        }
        <% } %>

        .rating-bar .rating-count {
          min-width: 40px;
          text-align: right;
        }
    </style>


    <script>
        // Simple function to show message
        document.getElementById('add-to-cart-btn').onclick = function() {
            const message = document.getElementById('cart-message');
            message.style.display = 'block';
            
            // Hide message after 4 seconds
            setTimeout(function() {
                message.style.display = 'none';
            }, 4000);
        };
    </script>
</body>
</html>